<div *ngIf="showTryAgainModal" class="modal-overlay">
  <div class="modal-content">
    <h2>Try Again?</h2>
    <p>You've reached the maximum number of tries.<br>Please restart the challenge.</p>
    <button class="modal-btn" (click)="restartCaptcha()">Restart</button>
  </div>
</div>

<div class="captcha-center-container">
  <div class="captcha-container">
    <h2 class="captcha-title">{{ challengeTitles[currentState] }}</h2>
    <div class="challenge-step">
      <div *ngIf="currentState === 1" @challengeTransition>
        <app-math-captcha
          [isCompleted]="completedStates[1]"
          (result)="handleCaptchaResult($event)">
        </app-math-captcha>
      </div>
      <div *ngIf="currentState === 2" @challengeTransition>
        <app-word-image-captcha
          [isCompleted]="completedStates[2]"
          (result)="handleCaptchaResult($event)">
        </app-word-image-captcha>
      </div>
      <div *ngIf="currentState === 3" @challengeTransition>
        <app-image-grid-captcha
          [isCompleted]="completedStates[3]"
          (result)="handleCaptchaResult($event)">
        </app-image-grid-captcha>
      </div>
    </div>
    <div class="captcha-navigation" *ngIf="!showTryAgainModal">
      <button 
        (click)="goToPreviousChallenge()" 
        [disabled]="currentState === 1">
        Previous
      </button>
      <button 
        (click)="goToNextChallenge()" 
        [disabled]="!completedStates[currentState] || currentState === 3">
        Next
      </button>
    </div>
  </div>
</div>
